-- iot_gateway
-- iot_gateway_credentials
-- iot_device
-- iot_device_credentials
CREATE TABLE iot_gateway
(
    id           BIGINT GENERATED BY DEFAULT AS IDENTITY,
    tenant_id    BIGINT                                                          NOT NULL,
    deleted_at   TIMESTAMP DEFAULT NULL,
    created_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP                             NOT NULL,
    updated_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
    name         VARCHAR(255)                                                    NOT NULL,
    code         VARCHAR(255)                                                    NOT NULL,
    disabled     TINYINT DEFAULT 0                                               NOT NULL,
    api_endpoint VARCHAR(1024),
    description  VARCHAR(512),
    offline_at   TIMESTAMP DEFAULT NULL,
    heartbeat_at TIMESTAMP DEFAULT NULL,
    PRIMARY KEY (id),
    CONSTRAINT uniq_iot_gateway_name UNIQUE (tenant_id, name)
);
CREATE TABLE iot_gateway_credentials
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY,
    tenant_id         BIGINT                                                          NOT NULL,
    deleted_at        TIMESTAMP DEFAULT NULL,
    created_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP                             NOT NULL,
    updated_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
    credentials_id    VARCHAR(4096)                                                   NOT NULL,
    credentials_type  VARCHAR(255)                                                    NOT NULL,
    credentials_value VARCHAR(4096)                                                   NOT NULL,
    iot_gateway_id    BIGINT                                                          NOT NULL,
    PRIMARY KEY (id)
);
CREATE TABLE iot_device
(
    id         BIGINT GENERATED BY DEFAULT AS IDENTITY,
    tenant_id  BIGINT                                                          NOT NULL,
    deleted_at TIMESTAMP DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP                             NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
    name       VARCHAR(255)                                                    NOT NULL,
    gateway_id BIGINT                                                          NOT NULL,
    code       VARCHAR(128),
    type       VARCHAR(128),
    PRIMARY KEY (id)
);
CREATE TABLE iot_device_credentials
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY,
    tenant_id         BIGINT                                                          NOT NULL,
    deleted_at        TIMESTAMP DEFAULT NULL,
    created_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP                             NOT NULL,
    updated_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
    credentials_id    VARCHAR(4096)                                                   NOT NULL,
    credentials_type  VARCHAR(255)                                                    NOT NULL,
    credentials_value VARCHAR(4096)                                                   NOT NULL,
    device_id         BIGINT                                                          NOT NULL,
    PRIMARY KEY (id)
);

